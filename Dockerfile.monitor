# Dockerfile.monitor

FROM python:3.10-slim

# ------------------------------------------------------------------
# System dependencies
# ------------------------------------------------------------------
RUN apt-get update && apt-get install -y --no-install-recommends \
    bash \
    procps \
 && rm -rf /var/lib/apt/lists/*

# ------------------------------------------------------------------
# Create airflow user + dirs (match Airflow container conventions)
# ------------------------------------------------------------------
RUN useradd -ms /bin/bash airflow && \
    mkdir -p /opt/airflow/logs /opt/airflow/artifacts /opt/airflow/tmp && \
    chown -R airflow:airflow /opt/airflow

WORKDIR /opt/airflow

# ------------------------------------------------------------------
# Python dependencies
# ------------------------------------------------------------------
COPY requirements-monitoring.txt .
RUN pip install --upgrade pip \
 && pip install --no-cache-dir -r requirements-monitoring.txt

# ------------------------------------------------------------------
# Copy monitoring source code
# ------------------------------------------------------------------
COPY src/ src/

# ------------------------------------------------------------------
# Runtime user
# ------------------------------------------------------------------
USER airflow

# ------------------------------------------------------------------
# Default command
# ------------------------------------------------------------------
CMD ["python", "src/monitor_predictions.py"]
